var VirtualTree=function(e){"use strict";return e.default=class{constructor(e,t){this.container=e,this.options={data:t.data||[],rowHeight:t.rowHeight||40,height:t.height||550,lazy:t.lazy||!1,onLoadData:t.onLoadData||null,onClick:t.onClick||null,onExpand:t.onExpand||null,onCollapse:t.onCollapse||null,onSelect:t.onSelect||null,onCheck:t.onCheck||null,onDrop:t.onDrop||null,onContextMenu:t.onContextMenu||null,renderNode:t.renderNode||null,selectable:t.selectable||!1,multiSelect:t.multiSelect||!1,cascadeSelect:t.cascadeSelect||!1,checkbox:t.checkbox||!1,draggable:t.draggable||!1,enableDefaultDragDrop:void 0===t.enableDefaultDragDrop||t.enableDefaultDragDrop,filter:t.filter||null},this.state={treeData:[...this.options.data],expandedIds:new Set,loadingIds:new Set,selectedIds:new Set,checkedIds:new Set,searchTerm:"",scrollTop:0,visibleNodes:[],focusedId:null,focusedIndex:-1,draggingNode:null,dragOverNode:null,customFilter:this.options.filter},this.init()}init(){this.container.innerHTML=`\n      <div class="flex flex-col border border-slate-200 rounded-xl bg-white shadow-sm overflow-hidden" style="height: ${this.options.height}px" tabindex="0" id="tree-container">\n        \x3c!-- Search Bar --\x3e\n        <div class="p-3 border-b border-slate-100 bg-slate-50/50 flex items-center gap-2">\n          <div class="relative flex-1">\n            <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>\n            <input type="text" id="tree-search" placeholder="노드 이름으로 검색..." class="w-full pl-9 pr-9 py-1.5 bg-white border border-slate-200 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all">\n          </div>\n          <div id="tree-count" class="text-[11px] font-medium text-slate-400 px-2 uppercase tracking-wider">0 items</div>\n        </div>\n\n        \x3c!-- Scroll Viewport --\x3e\n        <div id="tree-viewport" class="relative flex-1 overflow-auto custom-scrollbar">\n          <div id="tree-spacer" style="width: 100%; pointer-events: none;"></div>\n          <div id="tree-content-layer" class="absolute top-0 left-0 w-full tree-node-container"></div>\n        </div>\n      </div>\n    `,this.treeContainer=this.container.querySelector("#tree-container"),this.viewport=this.container.querySelector("#tree-viewport"),this.spacer=this.container.querySelector("#tree-spacer"),this.contentLayer=this.container.querySelector("#tree-content-layer"),this.searchInput=this.container.querySelector("#tree-search"),this.countDisplay=this.container.querySelector("#tree-count"),this.viewport.addEventListener("scroll",()=>{this.state.scrollTop=this.viewport.scrollTop,this.render()}),this.searchInput.addEventListener("input",e=>{this.setState({searchTerm:e.target.value,scrollTop:0}),this.viewport.scrollTop=0}),this.contentLayer.addEventListener("click",e=>{if(e.target.closest(".tree-checkbox")){const t=e.target.closest("[data-id]");return void(t&&(e.stopPropagation(),this.handleCheckboxClick(t.dataset.id,e)))}const t=e.target.closest("[data-id]");if(t){const s=t.dataset.id;this.handleNodeClick(s,e)}}),this.options.onContextMenu&&this.contentLayer.addEventListener("contextmenu",e=>{const t=e.target.closest("[data-id]");if(t){e.preventDefault();const s=this.findNodeById(t.dataset.id);s&&this.options.onContextMenu(s,e)}}),this.options.draggable&&(this.contentLayer.addEventListener("dragstart",e=>{const t=e.target.closest("[data-id]");t&&this.handleDragStart(e,t.dataset.id)}),this.contentLayer.addEventListener("dragover",e=>{e.preventDefault();const t=e.target.closest("[data-id]");t&&this.handleDragOver(e,t.dataset.id)}),this.contentLayer.addEventListener("drop",e=>{e.preventDefault();const t=e.target.closest("[data-id]");t&&this.handleDrop(e,t.dataset.id)}),this.contentLayer.addEventListener("dragleave",()=>{this.state.dragOverNode=null,this.render()})),this.treeContainer.addEventListener("keydown",e=>{this.handleKeyDown(e)}),this.updateVisibleNodes()}setState(e){this.state={...this.state,...e},this.updateVisibleNodes()}updateVisibleNodes(){const e=[];this.flattenFilteredTree(this.state.treeData,0,e),this.state.visibleNodes=e;const t=e.length*this.options.rowHeight;this.spacer.style.height=`${t}px`,this.countDisplay.textContent=`${e.length} items`,this.render()}flattenFilteredTree(e,t=0,s=[]){let i=!1;const d=this.state.searchTerm.trim().toLowerCase();for(const n of e){if(this.state.customFilter&&!this.state.customFilter(n))continue;const e=!!d&&n.label.toLowerCase().includes(d),o=[];let a=!1;n.children&&(a=this.flattenFilteredTree(n.children,t+1,o)),(!d||e||a)&&(s.push({...n,level:t,isMatch:e}),(d&&a||!d&&this.state.expandedIds.has(n.id))&&s.push(...o),(e||a)&&(i=!0))}return i}async handleNodeClick(e,t){const s=this.findNodeById(e);if(s)if(this.options.onClick&&this.options.onClick(s,t),this.options.selectable&&(this.options.multiSelect&&(t.ctrlKey||t.metaKey)?this.state.selectedIds.has(e)?(this.state.selectedIds.delete(e),this.options.cascadeSelect&&this.cascadeDeselectChildren(s)):(this.state.selectedIds.add(e),this.options.cascadeSelect&&this.cascadeSelectChildren(s)):(this.state.selectedIds.clear(),this.state.selectedIds.add(e),this.options.cascadeSelect&&this.cascadeSelectChildren(s)),this.state.focusedId=e,this.state.focusedIndex=this.state.visibleNodes.findIndex(t=>t.id===e),this.options.onSelect&&this.options.onSelect(this.getSelectedNodes()),this.render()),this.state.expandedIds.has(e))this.state.expandedIds.delete(e),this.options.onCollapse&&this.options.onCollapse(s),this.setState({});else if(this.options.lazy&&s.hasChildren&&!s.children){this.state.loadingIds.add(e),this.render();try{const t=await this.options.onLoadData(s),i=s=>s.map(s=>s.id===e?{...s,children:t}:s.children?{...s,children:i(s.children)}:s);if(this.state.treeData=i(this.state.treeData),this.state.expandedIds.add(e),this.options.checkbox&&this.state.checkedIds.has(e)){const e=t=>{t.forEach(t=>{this.state.checkedIds.add(t.id),t.children&&e(t.children)})};e(t)}if(this.options.selectable&&this.options.cascadeSelect&&this.state.selectedIds.has(e)){const e=t=>{t.forEach(t=>{this.state.selectedIds.add(t.id),t.children&&e(t.children)})};e(t)}this.options.onExpand&&this.options.onExpand(s)}finally{this.state.loadingIds.delete(e),this.setState({})}}else this.state.expandedIds.add(e),this.options.onExpand&&this.options.onExpand(s),this.setState({})}handleCheckboxClick(e,t){if(!this.options.checkbox)return;this.state.checkedIds.has(e)?this.uncheckNode(e,!0):this.checkNode(e,!0),this.options.onCheck&&this.options.onCheck(this.getCheckedNodes()),this.render()}handleDragStart(e,t){this.state.draggingNode=t,e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",t)}handleDragOver(e,t){this.state.draggingNode!==t&&(e.dataTransfer.dropEffect="move",this.state.dragOverNode!==t&&(this.state.dragOverNode=t,this._dragOverRenderScheduled||(this._dragOverRenderScheduled=!0,requestAnimationFrame(()=>{this.render(),this._dragOverRenderScheduled=!1}))))}handleDrop(e,t){this.state.draggingNode;const s=this.state.draggingNode;if(s&&s!==t){const e=this.findNodeById(s),i=this.findNodeById(t);if(e&&i){if(this.options.enableDefaultDragDrop){this.options.enableDefaultDragDrop;const t=this.isNodeDescendant(e.id,i.id);if(t)console.warn("⚠️ Cannot drop node onto its descendant");else{e.id;const t=this.removeNodeFromTree(this.state.treeData,e.id);if(t){i.id;this.insertNodeInTree(this.state.treeData,i.id,t,"inside");this.updateVisibleNodes()}else console.error("❌ Failed to remove node")}}this.options.onDrop&&this.options.onDrop(e,i,"inside")}else console.error("❌ Could not find dragged or target node")}this.state.draggingNode=null,this.state.dragOverNode=null,this.render()}handleKeyDown(e){if(!this.state.visibleNodes.length)return;let t=!1;switch(e.key){case"ArrowDown":this.moveFocus(1),t=!0;break;case"ArrowUp":this.moveFocus(-1),t=!0;break;case"ArrowRight":this.state.focusedId&&(this.expandNode(this.state.focusedId),t=!0);break;case"ArrowLeft":this.state.focusedId&&(this.collapseNode(this.state.focusedId),t=!0);break;case"Enter":this.state.focusedId&&(this.handleNodeClick(this.state.focusedId,e),t=!0);break;case" ":if(this.options.selectable&&this.state.focusedId){e.preventDefault();this.findNodeById(this.state.focusedId)&&this.handleNodeClick(this.state.focusedId,e),t=!0}}t&&e.preventDefault()}moveFocus(e){-1===this.state.focusedIndex&&this.state.visibleNodes.length>0?this.state.focusedIndex=0:this.state.focusedIndex=Math.max(0,Math.min(this.state.visibleNodes.length-1,this.state.focusedIndex+e)),this.state.visibleNodes[this.state.focusedIndex]&&(this.state.focusedId=this.state.visibleNodes[this.state.focusedIndex].id,this.render(),this.scrollToFocused())}scrollToFocused(){if(-1===this.state.focusedIndex)return;const{rowHeight:e}=this.options,t=this.state.focusedIndex*e,s=t+e,i=this.viewport.scrollTop,d=i+this.viewport.clientHeight;t<i?this.viewport.scrollTop=t:s>d&&(this.viewport.scrollTop=s-this.viewport.clientHeight)}getHighlightedText(e){if(!this.state.searchTerm)return e;const t=new RegExp(`(${this.state.searchTerm})`,"gi");return e.replace(t,"<mark>$1</mark>")}render(){const{visibleNodes:e,scrollTop:t}=this.state,{rowHeight:s,height:i}=this.options,d=Math.floor(t/s),n=Math.min(d+Math.ceil(i/s)+1,e.length),o=e.slice(d,n);this.contentLayer.style.transform=`translateY(${d*s}px)`,0!==o.length?this.contentLayer.innerHTML=o.map(e=>{const t=this.state.expandedIds.has(e.id)||this.state.searchTerm&&!e.isMatch,i=this.state.loadingIds.has(e.id),d=e.children||this.options.lazy&&e.hasChildren,n=this.state.selectedIds.has(e.id),o=this.state.focusedId===e.id,a=this.state.checkedIds.has(e.id),r=this.state.dragOverNode===e.id,l=this.options.renderNode?this.options.renderNode(e,this.state.searchTerm):`\n          <div class="flex items-center gap-2 overflow-hidden">\n            ${d?`<svg class="w-4 h-4 ${t?"fill-blue-100 text-blue-500":"text-slate-400"}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z"/></svg>`:'<svg class="w-4 h-4 text-slate-300" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>'}\n            <span class="text-sm text-slate-700 select-none truncate">${this.getHighlightedText(e.label)}</span>\n          </div>\n        `;return`\n        <div \n          data-id="${e.id}"\n          class="flex items-center px-2 hover:bg-blue-50/50 cursor-pointer transition-colors ${e.isMatch?"bg-blue-50/30":""} ${n?"bg-blue-100 border-l-2 border-blue-500":""} ${o?"ring-1 ring-blue-400":""} ${r?"bg-green-100":""}"\n          style="height: ${s}px; padding-left: ${20*e.level+8}px"\n          ${this.options.draggable?'draggable="true"':""}\n        >\n          ${this.options.checkbox?`\n            <div class="tree-checkbox mr-2">\n              <input type="checkbox" ${a?"checked":""} class="w-4 h-4 text-blue-600 rounded focus:ring-blue-500 cursor-pointer">\n            </div>\n          `:""}\n          \n          <div class="w-5 h-5 flex items-center justify-center mr-1">\n            ${i?'<svg class="w-3 h-3 animate-spin text-blue-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>':d?`<svg class="w-4 h-4 text-slate-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">${t?'<path d="m6 9 6 6 6-6"/>':'<path d="m9 18 6-6-6-6"/>'}</svg>`:""}\n          </div>\n          ${l}\n        </div>\n      `}).join(""):this.contentLayer.innerHTML='\n        <div class="flex flex-col items-center justify-center py-20 text-slate-400">\n          <p class="text-sm">검색 결과가 없습니다.</p>\n        </div>\n      '}findNodeById(e){const t=s=>{for(const i of s){if(i.id===e)return i;if(i.children){const e=t(i.children);if(e)return e}}return null};return t(this.state.treeData)}expandNode(e){if(!this.state.expandedIds.has(e)){this.state.expandedIds.add(e);const t=this.findNodeById(e);t&&this.options.onExpand&&this.options.onExpand(t),this.setState({})}}collapseNode(e){if(this.state.expandedIds.has(e)){this.state.expandedIds.delete(e);const t=this.findNodeById(e);t&&this.options.onCollapse&&this.options.onCollapse(t),this.setState({})}}async expandAll(){if(this.options.lazy){const e=async t=>{const s=t.map(async t=>{if(t.children||t.hasChildren)if(this.state.expandedIds.add(t.id),t.hasChildren&&!t.children)try{this.state.loadingIds.add(t.id),this.render();const s=await this.options.onLoadData(t),i=e=>e.map(e=>e.id===t.id?{...e,children:s}:e.children?{...e,children:i(e.children)}:e);if(this.state.treeData=i(this.state.treeData),this.options.checkbox&&this.state.checkedIds.has(t.id)){const e=t=>{t.forEach(t=>{this.state.checkedIds.add(t.id),t.children&&e(t.children)})};e(s)}if(this.options.selectable&&this.options.cascadeSelect&&this.state.selectedIds.has(t.id)){const e=t=>{t.forEach(t=>{this.state.selectedIds.add(t.id),t.children&&e(t.children)})};e(s)}this.state.loadingIds.delete(t.id),await e(s)}catch(s){console.error("Error loading children in expandAll:",s),this.state.loadingIds.delete(t.id)}else t.children&&await e(t.children)});await Promise.all(s)};await e(this.state.treeData),this.updateVisibleNodes()}else{const e=t=>{t.forEach(t=>{(t.children||t.hasChildren)&&this.state.expandedIds.add(t.id),t.children&&e(t.children)})};e(this.state.treeData),this.updateVisibleNodes()}}collapseAll(){this.state.expandedIds.clear(),this.setState({})}selectNode(e){this.options.selectable&&(this.options.multiSelect||this.state.selectedIds.clear(),this.state.selectedIds.add(e),this.options.onSelect&&this.options.onSelect(this.getSelectedNodes()),this.render())}unselectNode(e){this.state.selectedIds.delete(e),this.options.onSelect&&this.options.onSelect(this.getSelectedNodes()),this.render()}getSelectedNodes(){return Array.from(this.state.selectedIds).map(e=>this.findNodeById(e)).filter(Boolean)}clearSelection(){this.state.selectedIds.clear(),this.options.onSelect&&this.options.onSelect([]),this.render()}checkNode(e,t=!1){if(this.options.checkbox&&(this.state.checkedIds.add(e),t)){const t=this.findNodeById(e);if(t&&t.children){const e=t=>{t.forEach(t=>{this.state.checkedIds.add(t.id),t.children&&e(t.children)})};e(t.children)}}}uncheckNode(e,t=!1){if(this.options.checkbox&&(this.state.checkedIds.delete(e),t)){const t=this.findNodeById(e);if(t&&t.children){const e=t=>{t.forEach(t=>{this.state.checkedIds.delete(t.id),t.children&&e(t.children)})};e(t.children)}}}getCheckedNodes(){return Array.from(this.state.checkedIds).map(e=>this.findNodeById(e)).filter(Boolean)}setFilter(e){this.state.customFilter=e,this.updateVisibleNodes()}clearFilter(){this.state.customFilter=null,this.updateVisibleNodes()}refresh(){this.updateVisibleNodes()}setData(e){this.state.treeData=[...e],this.updateVisibleNodes()}getData(){return this.state.treeData}cascadeSelectChildren(e){e.children&&e.children.forEach(e=>{this.state.selectedIds.add(e.id),e.children&&this.cascadeSelectChildren(e)})}cascadeDeselectChildren(e){e.children&&e.children.forEach(e=>{this.state.selectedIds.delete(e.id),e.children&&this.cascadeDeselectChildren(e)})}removeNodeFromTree(e,t){for(let s=0;s<e.length;s++){if(e[s].id===t)return e.splice(s,1)[0];if(e[s].children){const i=this.removeNodeFromTree(e[s].children,t);if(i)return i}}return null}insertNodeInTree(e,t,s,i="inside"){for(let d=0;d<e.length;d++){if(e[d].id===t)return"inside"===i?(e[d].children||(e[d].children=[]),e[d].children.push(s)):"before"===i?e.splice(d,0,s):"after"===i&&e.splice(d+1,0,s),!0;if(e[d].children&&this.insertNodeInTree(e[d].children,t,s,i))return!0}return!1}isNodeDescendant(e,t){const s=(e,t)=>{for(const i of e){if(i.id===t)return i;if(i.children){const e=s(i.children,t);if(e)return e}}return null},i=(e,t)=>e.id===t||!!e.children&&e.children.some(e=>i(e,t)),d=s(this.state.treeData,e);return d&&i(d,t)}},Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}}),e}({});
//# sourceMappingURL=high-tree.iife.js.map
